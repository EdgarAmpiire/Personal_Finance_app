<!DOCTYPE html>
<html>
  <head>
    <title><%= content_for(:title) || "Personal Finance App" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= yield :head %>

    <link rel="icon" href="/icon.png" type="image/png">
    <link rel="icon" href="/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/icon.png">

    <%= stylesheet_link_tag "tailwind", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>

  <body class="min-h-dvh bg-gray-50 text-slate-900">
    <% if signed_in? %>
      <div class="min-h-dvh flex">

        <!-- Desktop sidebar (lg+) -->
        <aside class="hidden lg:flex lg:w-72 lg:flex-col lg:shrink-0 h-dvh bg-slate-900 text-slate-100">
          <div class="p-6">
            <div class="text-3xl font-semibold">Finance App</div>
          </div>

          <nav class="flex-1 px-4 pb-4 space-y-2 overflow-hidden">
            <%= nav_link "Overview", dashboard_path %>
            <%= nav_link "Accounts", accounts_path %>
            <%= nav_link "Transactions", transactions_path %>
            <%= nav_link "Budgets", budgets_path %>
            <%= nav_link "Pots", pots_path %>
            <%= nav_link "Recurring Bills", recurring_bills_path %>
          </nav>

          <div class="mt-auto p-4 border-t border-slate-800">
            <%= button_to "Sign out", sign_out_path, method: :delete,
              class: "w-full rounded bg-slate-800 px-3 py-2 text-left text-sm hover:bg-slate-700" %>
          </div>
        </aside>

        <!-- Main column -->
        <div class="flex-1 flex flex-col min-w-0 h-dvh overflow-hidden">

          <!-- Mobile/Tablet top bar (below lg) -->
          <header class="lg:hidden sticky top-0 z-40 border-b bg-white/90 backdrop-blur">
            <div class="mx-auto w-full max-w-6xl px-4 sm:px-6 py-3 flex items-center justify-between gap-3">
              <div class="text-lg font-semibold">Finance App</div>

              <!-- Drawer toggle (no JS required if you use <details>) -->
              <details class="relative">
                <summary class="list-none cursor-pointer select-none rounded-md border px-3 py-2 text-sm hover:bg-gray-50">
                  Menu
                </summary>

                <!-- Backdrop -->
                <div class="fixed inset-0 z-40 bg-black/30"></div>

                <!-- Drawer -->
                  <div class="fixed right-0 top-0 z-50 h-dvh w-80 max-w-[85vw] bg-slate-900 text-slate-100 shadow-xl flex flex-col overflow-hidden">
                   <div class="p-5 flex items-center justify-between border-b border-slate-800">
                    <div class="text-xl font-semibold">Navigation</div>
                    <span class="text-sm opacity-80">âœ•</span>
                  </div>

                  <nav class="flex-1 p-4 space-y-2 overflow-y-auto">
                    <%= nav_link "Overview", dashboard_path %>
                    <%= nav_link "Accounts", accounts_path %>
                    <%= nav_link "Transactions", transactions_path %>
                    <%= nav_link "Budgets", budgets_path %>
                    <%= nav_link "Pots", pots_path %>
                    <%= nav_link "Recurring Bills", recurring_bills_path %>
                  </nav>

                  <div class="mt-auto p-4 border-t border-slate-800">
                    <%= button_to "Sign out", sign_out_path, method: :delete,
                      class: "w-full rounded bg-slate-800 px-3 py-2 text-left text-sm hover:bg-slate-700" %>
                  </div>
                </div>
              </details>
            </div>
          </header>

          <!-- Page content -->
          <main class="flex-1 overflow-y-auto">
            <div class="mx-auto w-full max-w-6xl px-4 sm:px-6 lg:px-8 py-6">
              <% if notice %>
                <div data-controller="flash" class="mb-4 rounded bg-green-50 p-3 text-green-800">
                  <%= notice %>
                </div>
              <% end %>

              <% if alert %>
                <div data-controller="flash" class="mb-4 rounded bg-red-50 p-3 text-red-800">
                  <%= alert %>
                </div>
              <% end %>

              <%= yield %>
            </div>
          </main>
        </div>
      </div>

    <% else %>
      <div class="min-h-dvh flex items-center justify-center bg-gray-50 px-4 py-8">
        <div class="w-full max-w-md sm:max-w-lg">
          <% if notice %>
            <div data-controller="flash" class="mb-4 rounded bg-green-50 p-3 text-green-800"><%= notice %></div>
          <% end %>
          <% if alert %>
            <div data-controller="flash" class="mb-4 rounded bg-red-50 p-3 text-red-800"><%= alert %></div>
          <% end %>

          <div class="rounded-xl border bg-white p-6 sm:p-8 shadow-sm">
            <%= yield %>
          </div>
        </div>
      </div>
    <% end %>
  </body>
</html>